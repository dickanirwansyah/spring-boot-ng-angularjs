var App = angular.module('App', ['ngResource', 'ngRoute']);

App.controller('CtrlApp', function($scope, $http){

    console.log('Jika kamu melihat pesan ini console, maka angular JS berjalan dengan baik');

    $scope.jurusans = [];

    $scope.mahasiswas = [];

    $scope.mahasiswa = {
        idmahasiswa : -1,
        name : "",
        idjurusan : -1,
    };

    $scope.jurusan = {
        idjurusan : -1,
        name : "",
        active : "",
    };

    $scope.updateInitMahasiswa = function(mahasiswa){
        console.log("jurusan : "+mahasiswa.jurusan.idjurusan |"idmahasiswa : "+mahasiswa.idmahasiswa)
        $scope.mahasiswa.idmahasiswa = mahasiswa.idmahasiswa;
        $scope.mahasiswa.name = mahasiswa.name;
        $scope.mahasiswa.idjurusan = mahasiswa.jurusan.idjurusan;
    };

    //refresh data mahasiswa
    function reloadMahasiswa(){
        $http({
            method: 'GET',
            url: 'http://localhost:8080/api/mahasiswa/'
        }).then(function success(response){
            $scope.mahasiswas = response.data;
        }, function error(response){
            console.log(response.statusText);
        });
    };

    //refresh data
    function reloadData(){
        $http({
            method: 'GET',
            url: 'http://localhost:8080/api/jurusan/'
        }).then(function success(response){
            $scope.jurusans = response.data;
        }, function error(response){
            console.log(response.statusText);
        });
    };


    $scope.handleMahasiswaSubmit = function(){
        var method = "";
        var url = "";
        if($scope.mahasiswa.idmahasiswa == -1){
            method = "POST";
            url = "http://localhost:8080/api/mahasiswa/"+$scope.mahasiswa.idjurusan+"/create"
        }else{
            method = "PUT";
            url = "http://localhost:8080/api/mahasiswa/"+$scope.mahasiswa.idjurusan+"/update/"+$scope.mahasiswa.idmahasiswa;
        }
        $http({
            method: method,
            url: url,
            data: angular.toJson($scope.mahasiswa),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(ok, notok);
    };

    function ok(response){
        reloadMahasiswa();
        $scope.mahasiswa.idmahasiswa = -1;
        $scope.mahasiswa.name = "";
        $scope.mahasiswa.idjurusan = -1;
    };


    function notok(responses){
        console.log(response.statusText);
        console.log(response.status);
        alert(responses.status);
    };

    //save data
    $scope.handleSave = function(){
        var method = "";
        var url = "";
        if($scope.jurusan.idjurusan == -1){
            method = "POST";
            url = "http://localhost:8080/api/jurusan/";
        }else{
            method = "PUT";
            url = "http://localhost:8080/api/jurusan/"+$scope.jurusan.idjurusan;
        }

        $http({
            method : method,
            url : url,
            data : angular.toJson($scope.jurusan),
            headers : {
                'Content-Type': 'application/json'
            }
        }).then(successfully, unsuccessfully);
    };

    //update init
    $scope.updateJurusan = function(jurusan){
        console.log("idjurusan : "+jurusan.idjurusan);
        $scope.jurusan.idjurusan = jurusan.idjurusan;
        $scope.jurusan.name = jurusan.name;
        $scope.jurusan.active = jurusan.active;
    };

    function successfully(response){
        reloadData();
        $scope.jurusan.name = '';
        $scope.jurusan.idjurusan = -1;
        $scope.jurusan.active = '';
    };

    function unsuccessfully(response){
        console.log(response.statusText);
    };

    reloadData();
    reloadMahasiswa();
});